<template>
  <div class="w-full flex flex-col items-center">
    <div class="fish-section-card">
      <div
        class="section section-name w-full max-w-3xl text-center p-4 rounded-lg shadow-custom mb-4 flex flex-col items-center"
      >
        <div class="flex items-center justify-between w-full gap-2 mb-1">
          <div class="text text-xl text-secondary">魚的尺寸</div>
          <OverflowMenu
            :apiUrl="`/prefix/api/fish/${fishId}`"
            :redirectUrl="`/`"
            :fishId="fishId"
            :showDelete="false"
            :editUrl="`/fish/${fishId}/editSize`"
          />
        </div>
        <!-- 魚名與 icon 水平排列 -->
        <div
          class="section-title text-2xl font-bold text-primary mb-2 flex items-center justify-center w-full"
        >
          <span>！預留顯示長度的族語</span>
          <Volume class="ml-2" />
        </div>
      </div>
      <div class="arm-selector">
        <svg
          ref="svgRef"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          width="200"
          height="200"
          viewBox="0 0 500 400"
        >
          <path
            v-for="(d, idx) in paths"
            :key="idx"
            :d="d"
            :fill="isSelected(keys[idx]) ? selectedColor : defaultColor"
            class="segment"
            @mousedown.stop.prevent="onToggle(keys[idx])"
            :data-key="keys[idx]"
            :style="readonly ? 'cursor:default;' : ''"
          />
        </svg>
      </div>
    </div>
  </div>
</template>

<script setup>
import { defineProps, defineEmits } from 'vue'
import OverflowMenu from '@/Components/OverflowMenu.vue'

const props = defineProps({
  modelValue: {
    type: Array,
    default: () => [],
  },
  readonly: Boolean,
  fishId: {
    type: String,
    required: false,
  },
})
const emit = defineEmits(['update:modelValue'])

const selectedColor = '#f29e4c'
const defaultColor = '#FED8A8'

const keys = [
  '手指1',
  '手指2',
  '半掌1',
  '半掌2',
  '手掌',
  '下臂1',
  '下臂2',
  '下臂3',
  '下臂4',
  '下臂5',
  '下臂6',
  '下臂7',
  '上臂1',
  '上臂2',
  '上臂3',
  '上臂4',
  '肩膀',
]

// 依序貼上你的 17 個 path d 屬性
const paths = [
  // 手指1
  'M59.3154 1.69923C62.4812 4.42815 64.4222 7.31182 66.417 10.961L68.1365 14.0786L69.9404 17.3867C71.199 19.6488 72.4581 21.9105 73.7178 24.1719C75.8699 28.0581 77.9895 31.9576 80.0693 35.8828L55.0185 59.7057L29.9678 83.5282L29.9629 83.5261C27.5387 82.4917 25.0867 81.4453 22.6309 80.2883C18.2557 78.1909 13.9856 75.9443 9.75293 73.5742L7.84595 72.5383C4.57533 70.6922 2.15048 69.022 0.31543 65.6992C0.381262 61.9467 0.499442 59.6361 3.00293 56.7617C6.02917 55.3713 7.99002 55.4374 11.3154 55.6992C12.8544 56.3075 13.6655 56.6281 14.4594 56.9854C15.3424 57.3828 16.2048 57.8258 18.0264 58.7617L19.8839 59.7034C21.8254 60.6908 23.7578 61.6946 25.6904 62.6992C27.0115 63.3748 28.3331 64.0493 29.6553 64.7226C32.8819 66.3689 36.1006 68.03 39.3154 69.6992C35.277 66.6643 31.2343 63.6357 27.1748 60.6289L23.0654 57.5742L20.9639 56.0234C16.0224 52.341 14.5018 51.2078 13.2009 49.8621C12.6227 49.264 12.0879 48.6239 11.3154 47.6992C10.7526 43.759 10.7115 41.6414 12.8779 38.2617C16.3571 36.0315 18.2002 36.1966 22.3154 36.6992C25.6763 38.4193 28.6527 40.592 31.6904 42.8242C33.3021 43.9731 34.914 45.1216 36.5264 46.2695L38.9043 47.9853C42.6482 50.6466 46.4764 53.1778 50.3154 55.6992L47.8528 53.2524C44.8442 50.262 41.839 47.2682 38.8347 44.2734C37.5329 42.9766 36.2302 41.6807 34.9265 40.3857C33.0551 38.5264 31.1869 36.6639 29.3193 34.8008L27.5453 33.0424C24.317 29.8146 23.1116 28.6093 22.5962 27.1588C22.289 26.2943 22.227 25.3428 22.1279 23.8242C22.3131 20.7385 22.537 19.189 24.3154 16.6992C26.8475 14.6541 28.4065 14.6949 31.5296 14.7764L31.5308 14.7765L31.5328 14.7765C31.7021 14.7809 31.8759 14.7855 32.0547 14.7898C37.0532 15.4906 39.5067 17.981 42.8623 21.5625L44.6153 23.3455C46.4492 25.2184 48.2572 27.1141 50.0654 29.0117C51.2942 30.2757 52.5247 31.5381 53.7568 32.7988C56.0181 35.1171 58.2696 37.4439 60.5098 39.7825C62.7488 42.1185 65.0164 44.422 67.3154 46.6992L66.0178 44.4553C64.4051 41.6656 62.793 38.8755 61.1814 36.0852C60.4883 34.8855 59.7949 33.686 59.1013 32.4866C56.8317 28.5618 54.5714 24.6318 52.3154 20.6992L50.729 17.9597L49.3584 15.5586L48.1833 13.5147C46.8626 10.7521 46.7603 8.68333 47.3154 5.69923C50.294 0.451343 53.7359 0.218962 59.3154 1.69923Z',
  // 手指2
  'M80.0693 35.8828C82.3906 40.1704 84.5173 43.7049 87.1675 46.6992L44.6153 90.7801C40.003 87.811 35.0465 85.6958 29.9678 83.5285L55.0186 59.7057L80.0693 35.8828Z',
  // 半掌1
  'M87.1675 46.6992L44.6153 90.7801C48.9069 93.5427 52.9005 97.0448 56.4173 102.016L77.3663 78.3576L98.3154 54.6992C93.421 52.4753 89.996 49.8949 87.1675 46.6992Z',
  // 半掌2
  'M77.3663 78.3576L98.3154 54.6992L98.2678 52.8384C98.2047 50.0004 98.1662 47.1626 98.1279 44.3242L98.0518 41.3984C97.9754 33.8185 98.5189 26.1537 103.44 20.0742C106.415 18.6517 107.781 18.5493 110.995 18.6133L113.448 18.6509L115.315 18.6992L115.559 20.772C115.934 23.9563 116.312 27.1403 116.69 30.3242L117.104 33.8039C117.809 39.6784 118.554 45.537 119.44 51.3867C120.086 55.8383 120.524 60.2804 120.816 64.7226L71.2295 117.984C67.9095 115.18 64.8562 112.292 62.0029 109.012L60.2139 106.977C59.3136 105.897 58.8401 105.329 58.3888 104.744C57.8885 104.096 57.4152 103.427 56.4173 102.016L77.3663 78.3576Z',
  // 手掌
  'M120.816 64.7226L71.2295 117.984L73.3154 119.699C77.1327 122.895 80.9126 125.893 85.2373 128.379L121.315 93.6992C121.401 83.9745 121.45 74.3483 120.816 64.7226Z',
  // 下臂1
  'M85.2373 128.379L121.315 93.6992L123.135 94.5542C125.979 96.0477 128.317 98.0931 130.709 100.186C130.952 100.398 131.196 100.611 131.44 100.824C132.614 101.832 133.789 102.838 134.964 103.844L136.705 105.334C138.792 107.103 140.921 108.813 143.065 110.512L106.815 146.699C100.223 139.111 94.1019 133.261 85.2373 128.379Z',
  // 下臂2
  'M143.065 110.512L106.815 146.699C109.362 149.671 112.029 152.451 114.815 155.199C116.979 157.333 119.104 159.463 121.128 161.73L121.315 161.949L160.481 124.708C154.707 119.937 148.934 115.167 143.065 110.512Z',
  // 下臂3
  'M121.315 161.949C124.29 165.412 127.311 168.741 130.565 171.949C132.982 174.329 135.333 176.726 137.612 179.237L173.815 135.699L173.133 135.137C169.78 132.377 166.427 129.617 163.078 126.853C162.223 126.147 161.368 125.44 160.513 124.734L160.503 124.726L160.492 124.717L160.481 124.708L121.315 161.949Z',
  // 下臂4
  'M137.612 179.237L137.737 179.375C141.846 183.976 146.107 188.452 150.5 192.799L186.565 146.199L180.19 140.949L178.065 139.199L173.815 135.699L137.612 179.237Z',
  // 下臂5
  'M150.5 192.799L186.565 146.199L188.691 147.95L191.795 150.507L192.932 151.443C196.521 154.399 200.112 157.354 203.706 160.305L163.078 204.576C158.78 200.766 154.583 196.838 150.5 192.799Z',
  // 下臂6
  'M203.706 160.305L163.078 204.576C166.861 207.931 170.721 211.195 174.648 214.366L176.315 215.699C178.14 217.159 179.979 218.593 181.834 220L219.615 173.5C214.346 169.061 209.031 164.679 203.706 160.305Z',
  // 下臂7
  'M181.834 220L219.615 173.5C221.515 175.1 223.409 176.708 225.295 178.325C227.644 180.498 228.795 181.562 230.145 182.205C231.441 182.821 232.92 183.051 235.819 183.5L199.809 232.5C193.657 228.593 187.669 224.427 181.834 220Z',
  // 上臂1
  'M235.819 183.5L199.809 232.5C207.933 237.66 216.343 242.37 225.065 246.637L265 176.602C260.412 177.601 255.836 178.721 251.253 179.887L250.697 180.035L250.208 180.166L249.609 180.327C245.046 181.552 240.497 182.773 235.819 183.5Z',
  // 上臂2
  'M225.065 246.637L265 176.602C275.695 174.274 286.457 172.603 297.526 172.551L254 263.71C250.012 261.481 246.159 258.985 242.296 256.291C236.774 252.495 231.109 249.51 225.065 246.637Z',
  // 上臂3
  'M297.526 172.551L254 263.71C258.166 266.04 262.48 268.078 267.106 269.749C277.013 273.092 287.244 274.84 297.526 275.218L325.5 170.977C318.545 171.925 311.493 172.488 304.169 172.522L300.998 172.535L299.705 172.54L297.526 172.551Z',
  // 上臂4
  'M297.526 275.218L325.5 170.977C336.352 169.496 346.967 167.076 358.009 164.262L366.315 258.699L363.194 260.273C342.972 270.265 320.123 276.048 297.526 275.218Z',
  // 肩膀
  'M358.009 164.262L366.315 258.699C366.882 259.692 367.158 260.177 367.315 260.698C367.465 261.194 367.507 261.723 367.588 262.757C370.036 291.518 377.002 319.536 387.34 346.453L388.753 350.074C392.828 360.531 397.521 370.511 402.315 380.699H462.315C461.647 356.237 460.664 331.802 459.543 307.356C459.294 301.923 459.046 296.49 458.8 291.057C458.334 280.767 457.865 270.477 457.395 260.188C456.856 248.401 456.32 236.615 455.784 224.829C454.631 199.452 453.475 174.076 452.315 148.699C449.845 148.699 448.9 148.699 447.975 148.833C447.402 148.916 446.836 149.05 445.921 149.268C431.43 153.523 416.599 156.365 401.585 157.963L398.003 158.324C395.618 158.565 393.232 158.804 390.847 159.043C379.732 160.151 368.854 161.514 358.009 164.262Z',
]

function isSelected(key) {
  const idx = keys.indexOf(key)
  return idx >= 0 && idx < props.modelValue.length
}

function onToggle(key) {
  if (props.readonly) return
  const idx = keys.indexOf(key)
  if (idx === -1) return
  // 如果已經選到這個，則清空
  if (props.modelValue.length === idx + 1) {
    emit('update:modelValue', [])
  } else {
    emit('update:modelValue', keys.slice(0, idx + 1))
  }
}
</script>

<style scoped>
.arm-selector {
  max-width: 420px;
  margin: 0 auto;
  user-select: none;
}
.segment {
  cursor: pointer;
  transition: fill 0.2s;
}
</style>
