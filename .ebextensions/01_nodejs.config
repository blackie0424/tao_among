commands:
  01_install_nodejs:
    command: |
      # 檢查是否已安裝 Node.js
      if ! command -v node &> /dev/null || [[ $(node --version | cut -d. -f1 | tr -d 'v') -lt 18 ]]; then
        echo "Installing Node.js 20.x LTS..."
        
        # 移除舊版本（如果有）
        yum remove -y nodejs npm 2>/dev/null || true
        
        # 安裝 Node.js 20.x（Amazon Linux 2023）
        dnf module reset nodejs -y 2>/dev/null || true
        dnf module enable nodejs:20 -y 2>/dev/null || yum install -y nodejs20 2>/dev/null || {
          # 如果 dnf module 不可用，使用 NodeSource
          curl -fsSL https://rpm.nodesource.com/setup_20.x | bash -
          yum install -y nodejs
        }
        
        echo "Node.js installed: $(node --version)"
        echo "npm installed: $(npm --version)"
      else
        echo "Node.js already installed: $(node --version)"
      fi
    ignoreErrors: false
